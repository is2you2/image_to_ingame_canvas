<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Palette + CMD Manager</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            padding: 16px;
        }

        #paletteUI {
            margin-bottom: 12px;
        }

        .palette-item {
            display: grid;
            grid-template-columns: 50px 100px 1fr 60px;
            gap: 8px;
            align-items: start;
            margin: 8px 0;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .palette-item input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            padding: 0;
        }

        .palette-item .hex {
            font-family: monospace;
            width: 90px;
            height: 32px;
        }

        .palette-item textarea {
            width: 100%;
            min-height: 3.6em;
            /* ÏïΩ 3Ï§Ñ */
            resize: vertical;
            font-family: monospace;
        }

        .palette-item button {
            cursor: pointer;
            height: 32px;
        }

        #controls {
            margin-top: 16px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        pre {
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            max-height: 300px;
            overflow: auto;
        }
    </style>
</head>

<body>

    <h2>Palette + CMD Manager</h2>

    <div id="paletteUI"></div>

    <div id="controls">
        <button id="addColorBtn">+ Add Entry</button>
        <button id="saveJsonBtn">üíæ Save 00_palette.json</button>
    </div>

    <h3>Debug: Palette JSON</h3>
    <pre id="debug"></pre>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // ÌåîÎ†àÌä∏ Îç∞Ïù¥ÌÑ∞
            let palette = [
                { color: '#000000', cmd: '' },
                { color: '#ffffff', cmd: '' },
                { color: '#ff0000', cmd: 'spawn_enemy();' },
                { color: '#00ff00', cmd: 'heal_player(10);' },
                { color: '#0000ff', cmd: '// water tile\nset_water(true);' },
            ];

            const paletteUI = document.getElementById('paletteUI');
            const addColorBtn = document.getElementById('addColorBtn');
            const saveJsonBtn = document.getElementById('saveJsonBtn');
            const debug = document.getElementById('debug');

            if (!paletteUI || !addColorBtn || !saveJsonBtn) {
                console.error('UI element not found:', {
                    paletteUI, addColorBtn, saveJsonBtn
                });
                return;
            }

            function renderPaletteUI() {
                paletteUI.innerHTML = '';

                palette.forEach((entry, index) => {
                    const row = document.createElement('div');
                    row.className = 'palette-item';

                    // Color picker
                    const colorInput = document.createElement('input');
                    colorInput.type = 'color';
                    colorInput.value = entry.color;
                    colorInput.addEventListener('input', () => {
                        entry.color = colorInput.value;
                        hexInput.value = entry.color;
                        updateDebug();
                    });

                    // Hex input
                    const hexInput = document.createElement('input');
                    hexInput.type = 'text';
                    hexInput.value = entry.color;
                    hexInput.className = 'hex';
                    hexInput.addEventListener('change', () => {
                        if (/^#[0-9a-fA-F]{6}$/.test(hexInput.value)) {
                            entry.color = hexInput.value;
                            colorInput.value = entry.color;
                            updateDebug();
                        } else {
                            hexInput.value = entry.color;
                        }
                    });

                    // CMD textarea
                    const cmdInput = document.createElement('textarea');
                    cmdInput.placeholder = 'Command / Script for this color...';
                    cmdInput.value = entry.cmd;
                    cmdInput.addEventListener('input', () => {
                        entry.cmd = cmdInput.value;
                        updateDebug();
                    });

                    // Delete button
                    const delBtn = document.createElement('button');
                    delBtn.textContent = '‚úñ';
                    delBtn.title = 'Delete';
                    delBtn.addEventListener('click', () => {
                        palette.splice(index, 1);
                        renderPaletteUI();
                        updateDebug();
                    });

                    row.appendChild(colorInput);
                    row.appendChild(hexInput);
                    row.appendChild(cmdInput);
                    row.appendChild(delBtn);

                    paletteUI.appendChild(row);
                });
            }

            addColorBtn.addEventListener('click', () => {
                console.log('Add Entry clicked');
                palette.push({
                    color: '#888888',
                    cmd: ''
                });
                renderPaletteUI();
                updateDebug();
            });

            saveJsonBtn.addEventListener('click', () => {
                const json = JSON.stringify(palette, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = '00_palette.json';
                document.body.appendChild(a);
                a.click();

                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });

            function updateDebug() {
                debug.textContent = JSON.stringify(palette, null, 2);
            }

            // Ï¥àÍ∏∞ Î†åÎçî
            renderPaletteUI();
            updateDebug();

        });
    </script>
</body>
</html>